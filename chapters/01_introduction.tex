%!TEX root = ../main.tex

\chapter{Introduction}
\label{chp:intro}

\section{General introduction}
The \ac{3GPP}\footnote{\href{https://www.3gpp.org}{\texttt{3gpp.org}}}, the standardization body for the development of protocols for mobile communication networks, recently put a great emphasis on the importance of the integration of different access technologies along with the existing terrestrial mobile telecommunication infrastructure \cite{3gpp-tr-21.917}. This choice was made to accomodate for the ever-increasing number of Internet-connected devices and the need for wide-area coverage as well as ensuring service availability, continuity and scalability \cite{ntn-survey-rinaldi}.

Specifically, the envisioned future for mobile communications, starting with the already established 5G \ac{NR} and further expansions with the new sixth-generation cellular networks (6G), foresees the integration of a new non-terrestrial component. The latest \ac{3GPP} releases (Rel. 17 and Rel. 18) require 5G and 6G networks to be able to provide non-terrestrial satellite access complementing the already existing terrestrial access technologies. This because \ac{NTN}s have the right characteristics to satisfy the needs previously expressed, overcoming the limitations of the current terrestrial infrastructure, as detailed in the following sections \cite{overview-rel-17-18-saad, 5g-nr-communication-geo-leo-maattanen}.

To give a proper definition, the term \ac{NTNs} refers to a category of networks where at least one link is routed via an aerial-borne or space-borne vehicle such as \ac{HAPs}, \ac{UAVs} or telecommunication satellites.

\section{Limitations of terrestrial networks}
In order to explain the motivations behind the choice of expanding the current terrestrial infrastructure, the following sections present a few scenarios where the current terrestrial infrastructure fails to provide an adequate service due to some of their intrinsic limitations, and \ac{NTNs} can help to provide a better coverage.

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\textwidth]{res/sat-usecases.png}
    \caption{NTN use cases, courtesy of \href{https://telecominfraproject.com/ntcs/}{telecominfraproject.com}}
    \label{fig:sat-use-cases}
\end{figure}

\subsection{Remote places}
While \ac{TN} make the well-established foundation of todayâ€™s mobile communication infrastructure, their own nature poses some intrinsic limitations to their deployment in certain scenarios, especially in contexts of rural and remote areas. Conditions such as harsh terrain and geographical impediments like mountain ranges and large bodies of water act as natural barriers to the deployment of terrestrial infrastructure \cite{ntn-6g-era-challenges-giordani}. Moreover, the need for ground equipments such as base stations requires the presence of an already established and reliable power grid, further driving up the costs that telecommunication companies would have to sustain to bring connectivity in isolated areas without such amenities.

\paragraph{Population density}
The population density in remote and rural places is typically much lower than in the urban areas, and users are distributed in vast areas of land. Because of this reason, the investment that has to be made on a per-user basis in order to provide coverage would be much higher compared to a more urbanized scenario, where potential users are more densely distributed. The already high infrastructure cost will therefore have a hard time generating any profit, making this kind of market even more unattractive to private investors and further limiting the possibility for the people living there to access the internet, a resource which is becoming increasingly more important as time goes by \cite{6g-bridging}.

\paragraph{} 
In those scenarios, the large coverage area of \ac{NTN}s can help providing a cheaper alternative to traditional access solutions that no longer requires the ubiquitous presence of costly ground infrastructure. In this way, telecommunication companies are be able to serve many users with the same satellite even if those users are loceted in isolated places, contributing to depreciate the necessary investment to reach each one of them.

\paragraph{Opportunities}
As studied and documented in \cite{6g-challenge-opportunity-base-pyramid}, the issue of an inadequate broadband coverage in rural regions is an enormous challenge. Providing connectivity to the half of the world population living in rural or underprivileged areas requires a colossal effort, but it would also be a unique opportunity to kick-start the economy of currently underdeveloped countries. Access to the Internet would provide the population a possibility to progress on the educational, environmental, business and health planes, promoting a more fair access to information and alleviating the problem of digital divide between different parts of the world.

\subsection{Emergency communication and additional capacity}
Another limitation of the current terrestrial infrastructure is the lack of redundancy and robustness against natural disasters. Extreme events such as earthquakes, hurricanes, fires and floods, but also deliberate behaviors such as targeted attacks by terrorist organizations and sabotages can disrupt the connectivity, leading to outages that can potentially last for a long period of time. This in turn can cause significant economical damage and, in emergency situations, hinder the already difficult rescue efforts, potentially even leading to loss of lives \cite{ntn-6g-era-challenges-giordani}.

The simple installation of additional base stations is not a viable solution because they would all share the same weaknesses, and extreme weather events such as tornados would easily be able to render all the additional equipment useless. The cost of essentially doubling the existing access network to make it more resilient would be enormous.

In this scenario, \ac{NTNs} can act as a redundant access methodology to decrease the downtimes of terrestrial infrastructure, providing emergency communication services as well as additional capacity when required.

Fig. \ref{fig:multiple-connectivity}, courtesy of \cite{3gpp-tr-38.811}, shows a scenario where terrestrial and non-terrestrial access technologies are used transparently to access the network. It depicts a \ac{UE} that can use both the non-terrestrial link provided by the satellite or the terrestrial one. In this case, the satellite is connected to a ground gateway where the \ac{gNB} is located, therefore only rerouting the signal coming from the \ac{UE}.

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.7\textwidth]{res/multiple-connectivity.png}
    \caption{Transparent use of multiple radio access technology \cite{3gpp-tr-38.811}}
    \label{fig:multiple-connectivity}
\end{figure}

\subsection{Long distances and sensors}
Remote equipment, offshore plants and distribution grids will also benefit from the research carried out in this field, since providing terrestrial connectivity in those scenarios is a very challenging task due to the physically long distances between end nodes and the data collectors (generally a gateway or a base station). The installation of an underwater optical fiber link to serve a single endpoint, such as an offshore oil rig or power plant located in the open ocean, would bear a disproportional cost compared to the functions required, and providing maintenance would be another challenging and expensive task. 
The deployment of \ac{NTN}s would be the easiest way to provide connectivity on a global scale, therefore allowing internet access in isolated places without the need for an expensive, dedicated connection.

Consider now the problem of connecting a number of sensors sparsely distributed in a large area. When distances are large, solutions may be either the densification of radio stations or the use of custom made hardware. However, those approaches have their downsides and are not always feasible, requiring costly, ad-hoc solutions tailored for each specific scenario. In this case, the vast coverage area of \ac{NTNs} will undoubtedly be useful to provide connection to and from the sensors\cite{performance-ntn-support-iot-wang}.

\paragraph{} Other scenarios where \ac{NTNs} can become useful in overcoming the limitation of their terrestrial counterpart are well described in \cite{ntn-6g-era-challenges-giordani} and \cite{potential-multilayered-nierarchical-ntn-wang}.


\section{Thesis objectives and structure}

The main objective of this thesis is to use and extend a full-stack end-to-end network simulator to: (1) evaluate the problems of the current 5G \ac{NR} protocol stack for an \ac{NTN} satellite scenario characterized by high propagation delays, and (2) design, implement and evaluate original protocol solutions for \ac{NTN}, focusing on the role of retransmissions via \ac{HARQ} and scheduling. We aim at adapting the current implementation of the ns-3 network simulator software to be able to work in a non-terrestrial scenario with a high propagation delay, as well as adapting the layer-2 protocols to work under such conditions. Then, a performance evaluation will be carried out to study the effects of \ac{NTN} on the protocols' behavior, identifying any erroneous behavior and proposing innovative solutions tailored to the characteristics of \ac{NTN}s.

Despite \ac{3GPP} interest in this evolving field, the literature on this topic is still scarce. The effects of high propagation delays on the \ac{NR} protocol stack have not been properly simulated and documented, since the tools for network simulations have little to no support for \ac{3GPP}-like \ac{NTN}s. 

This thesis will approach the problem by implementing a non-terrestrial communication scenario in the ns-3 simulator, creating a testing framework that is currently not available as part of the original codebase of the software, modifying and rewriting the code for the protocols that misbehave, as well as optimizing their behaviors via the analysis of numerous simulations. This practical approach will provide a continuous feedback, enforcing a bottom-up attitude, meaning that the first layers of the protocol stack that will experience a rework will be the lowest ones, gradually moving up the ladder until we have a full working stack.

\paragraph{}
At the end of this thesis, important modifications were made to the \ac{NR} protocol stack implementation to be able to work in non-terrestrial scenarios. Numerous problems linked to the scheduler were solved, i.e., makig it correctly account for propagation delays by scheduling resources with a longer sdvance compared to the terrestrial implementation, reworking the \ac{BSR} mechanism of the \ac{UE} to improve the efficiency of the communication, and changing the reordering timers to avoid discarding correctly received packets. 

\ac{HARQ} protocol was reworked as well by evaluating the performance of increasing the number of concurrent processes per-user, as well as proposing a more aggressive version and evaluating its behavior. Since \ac{3GPP} proposed to completely disable the protocol, simulations were conducted comparing scenarios with and without \ac{HARQ}, and it was argued that disabling the protocol can be beneficial only in high SNR scenarios, while low SNR ones can still benefit from its usage to improve reliability.

\paragraph{}
After the above introduction, Chapter \ref{chp:ntn} consists of a deep dive into the field of non-terrestrial networks, resulting from a comprehensive review of the current state of the art. The three main categories of telecommunication satellites are described, and their characteristics evaluated. Finally, an overview of the possible payload design choices is presented, discussing advantages and disadvantages, as well as a brief description of the potential of multilayered networks.

\paragraph{}
Chapter \ref{chp:ns3} is focused on the state of the art of network simulation softwares and ns-3, the employed one, highlighting the non-terrestrial channel module used as well as its implementation, and detailing the reasons behind its choice. 

\paragraph{}
After the initial presentation and characterization of the used tools, Chapter \ref{chp:scheduling_problems} is about the design and implementation of an extension to the network simulator ns-3 for simulating the \ac{NR} stack in \acp{NTN}. We present the simulated scenario, describing the characteristics and the parameters of all the involved devices.
The problems encountered whilst reworking the \ac{NR} stack are presented, many of them involving the scheduler, and the implemented solutions are carefully explained. 

In Chapter \ref{chp:scheduling_problems}, the scheduler was modified to schedule resources more in advance to account for the additional delay introduced by the satellites, and to expect a non-immediate \ac{UE} response, a behavior that was not considered in the standard ns-3 implementation for terrestrial-like scenarios.

A problem regarding the expiration of buffer status reports also arose, leading to wasted resources since the \ac{UE} essentially flooded the base station with unnecessary requests. A modification was implemented to allow a \ac{UE} to wait for at least a full round-trip time before trying to send a new request.

The standard implementation of the \ac{UE} MAC protocol is configured in such a way that each incoming packet triggers a scheduling request for the full transmission buffer, regardless of previous requests that may still be in transit, therefore wasting capacity. The implementation of a less aggressive mechanism managed to increase the efficiency.


\paragraph{}
Then, moving up in the ladder of protocol layers, the problems related to the operation of \ac{HARQ} in a non-terrestrial scenario are presented in Chapter \ref{chp:harq}, discussing the effects of propagation delay as well as the impact of different values of SNR, linked to the satellite orbiting altitude and \ac{UE} antenna. Some new \ac{HARQ} solutions for \ac{NTN} are proposed and evaluated using the ns-3 network simulator.

The maximum number of concurrent \ac{HARQ} processes that \ac{NR} implementation enforces is found to be a major limiting factor for the throughput, therefore its increase has been evaluated, and, while this managed to increase the achievable throughput, its effects were limited when compared with the additional complexity that such approach would require.

Simulations performed without \ac{HARQ} showed that better results could be obtained, but this solution only works in conditions with high SNR, therefore a more aggressive version of \ac{HARQ} is proposed, and implemented and evaluated in ns-3, aimed at lowering the impact of the limited amount of concurrent processes.

\paragraph{}
Finally, the conclusions of this thesis are presented in Chapter \ref{chp:conclusions}, highlighting how scheduler and \ac{HARQ} are affected by the characteristics of a non-terrestrial link, summarizing all the obtained results as well as the proposed solutions, and providing some paths that can be explored in future studies.